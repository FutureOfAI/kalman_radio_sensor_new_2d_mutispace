
clear all
close all

num_Anc=10;
max_x=10;
max_y=10;
max_z=10;

Anc=rand(3,num_Anc);
Anc(1,:)=Anc(1,:)*max_x;
Anc(2,:)=Anc(2,:)*max_y;
Anc(3,:)=Anc(3,:)*max_z;

A_real=[3.82,5.64,2.8]
                                   %  0   0.17  7.78  7.65
C=[ 0   0.17  7.78  7.65 ;         % 0.9 11.8 11.7  0.13
    0.9  11.8   11.7   0.13 ;      % 2.75  2.72  2.5 2.7
   .75  1.75  1.5   1.5];          %  C=[ 0    10    0    10;         
                                    %     0    0    10    10;
                                     %    2.6  2.5  2.8  2.9];
                                     
r1=  sqrt((C(1,1)-A_real(1)).^2 + (C(2,1)-A_real(2)).^2+(C(3,1)-A_real(3)).^2);                                  
r2=  sqrt((C(1,2)-A_real(1)).^2 + (C(2,2)-A_real(2)).^2+(C(3,2)-A_real(3)).^2);                                  
r3=  sqrt((C(1,3)-A_real(1)).^2 + (C(2,3)-A_real(2)).^2+(C(3,3)-A_real(3)).^2);                                  
r4=  sqrt((C(1,4)-A_real(1)).^2 + (C(2,4)-A_real(2)).^2+(C(3,4)-A_real(3)).^2);                                  




r(1,:)=sqrt((C(1,1)-Anc(1,:)).^2 + (C(2,1)-Anc(2,:)).^2+(C(3,1)-Anc(3,:)).^2);
r(2,:)=sqrt((C(1,2)-Anc(1,:)).^2 + (C(2,2)-Anc(2,:)).^2+(C(3,2)-Anc(3,:)).^2);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
r(3,:)=sqrt((C(1,3)-Anc(1,:)).^2 + (C(2,3)-Anc(2,:)).^2+(C(3,3)-Anc(3,:)).^2);
r(4,:)=sqrt((C(1,4)-Anc(1,:)).^2 + (C(2,4)-Anc(2,:)).^2+(C(3,4)-Anc(3,:)).^2);
%error area is +-0.1m
e_A=0.01;
e=randn(4,num_Anc)*e_A;

r_e=r+e;
%~t
%e_real=0.2;
e_real = -0.1+0.2*rand(1,4);
r1_e=r1+e_real(1);
r2_e=r2+e_real(2);
r3_e=r3+e_real(3);
r4_e=r4+e_real(4);
b_real=[r2^2-r1^2+C(1,1)^2-C(1,2)^2+C(2,1)^2-C(2,2)^2+C(3,1)^2-C(3,2)^2;r3^2-r1^2+C(1,1)^2-C(1,3)^2+C(2,1)^2-C(2,3)^2+C(3,1)^2-C(3,3)^2;r4^2-r1^2+C(1,1)^2-C(1,4)^2+C(2,1)^2-C(2,4)^2+C(3,1)^2-C(3,4)^2]
b_real_e=[r2_e^2-r1_e^2+C(1,1)^2-C(1,2)^2+C(2,1)^2-C(2,2)^2+C(3,1)^2-C(3,2)^2;r3_e^2-r1_e^2+C(1,1)^2-C(1,3)^2+C(2,1)^2-C(2,3)^2+C(3,1)^2-C(3,3)^2;r4_e^2-r1_e^2+C(1,1)^2-C(1,4)^2+C(2,1)^2-C(2,4)^2+C(3,1)^2-C(3,4)^2]

%t@I
A_x2=[2*(C(1,2)-C(1,1)) 2*(C(2,2)-C(2,1)) 2*(C(3,2)-C(3,1));2*(C(1,2)-C(1,3)) 2*(C(2,2)-C(2,3))  2*(C(3,2)-C(3,3));2*(C(1,2)-C(1,4)) 2*(C(2,2)-C(2,4))  2*(C(3,2)-C(3,4))];
b_x2=[r1^2-r2_e^2+C(1,2)^2-C(1,1)^2+C(2,2)^2-C(2,1)^2+C(3,2)^2-C(3,1)^2;r3^2-r2_e^2+C(1,2)^2-C(1,3)^2+C(2,2)^2-C(2,3)^2+C(3,2)^2-C(3,3)^2;r4^2-r2_e^2+C(1,2)^2-C(1,4)^2+C(2,2)^2-C(2,4)^2+C(3,2)^2-C(3,4)^2]
B_x2=inv(A_x2)
Solution_Anc_x2=inv(A_x2)*b_x2;

%%%
A=[2*(C(1,1)-C(1,2)) 2*(C(2,1)-C(2,2)) 2*(C(3,1)-C(3,2));2*(C(1,1)-C(1,3)) 2*(C(2,1)-C(2,3))  2*(C(3,1)-C(3,3));2*(C(1,1)-C(1,4)) 2*(C(2,1)-C(2,4))  2*(C(3,1)-C(3,4))];
b=[r(2,:).^2-r(1,:).^2+C(1,1)^2-C(1,2)^2+C(2,1)^2-C(2,2)^2+C(3,1)^2-C(3,2)^2;r(3,:).^2-r(1,:).^2+C(1,1)^2-C(1,3)^2+C(2,1)^2-C(2,3)^2+C(3,1)^2-C(3,3)^2;r(4,:).^2-r(1,:).^2+C(1,1)^2-C(1,4)^2+C(2,1)^2-C(2,4)^2+C(3,1)^2-C(3,4)^2]
b_e=[r_e(2,:).^2-r_e(1,:).^2+C(1,1)^2-C(1,2)^2+C(2,1)^2-C(2,2)^2+C(3,1)^2-C(3,2)^2;r_e(3,:).^2-r_e(1,:).^2+C(1,1)^2-C(1,3)^2+C(2,1)^2-C(2,3)^2+C(3,1)^2-C(3,3)^2;r_e(4,:).^2-r_e(1,:).^2+C(1,1)^2-C(1,4)^2+C(2,1)^2-C(2,4)^2+C(3,1)^2-C(3,4)^2];
B=inv(A)
Solution_Anc_real=inv(A)*b_real;
Solution_Anc_real_e=inv(A)*b_real_e;
Solution_Anc=inv(A)*b;
Solution_Anc_e=inv(A)*b_e;

dis_e=Solution_Anc_e-Anc;
er(:)=sqrt(dis_e(1,:).^2+dis_e(2,:).^2+dis_e(3,:).^2);

mean(er)

% E=S-A

%plot(4,4,'rsquare',4,6,'rsquare',6,6,'rsquare')

%plot(0,0,'r*',0,8,'r*',8,8,'r*',8,0,'r*')
%plot(A(1,1),A(2,1),'rsquare',S(1,1),S(2,1),'r*',A(1,2),A(2,2),'gsquare',S(1,2),S(2,2),'g*',A(1,3),A(2,3),'bsquare',S(1,3),S(2,3),'b*',A(1,4),A(2,4),'csquare',S(1,4),S(2,4),'c*',A(1,5),A(2,5),'msquare',S(1,5),S(2,5),'m*',A(1,6),A(2,6),'rsquare',S(1,6),S(2,6),'r*',A(1,7),A(2,7),'ysquare',S(1,7),S(2,7),'y*',A(1,8),A(2,8),'ksquare',S(1,8),S(2,8),'k*',A(1,9),A(2,9),'wsquare',S(1,9),S(2,9),'w*');
% plot(A(1,10),A(2,10),'rsquare',S(1,10),S(2,10),'r*');
%figure (1)
%mesh(Solution_Anc);
% mesh(Anc(1,:),Anc(2,:),Anc(3,:),'rsquare', Solution_Anc_e(1,:),Solution_Anc_e(2,:),Solution_Anc_e(3,:),'bsquare');

%figure (2)
 %bar(er);


% figure (2)
% mesh(Solution_Anc_e);










% hold on
%                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
% title('Test')
% xlabel('Y position in m')
% ylabel('X position in m')
% axis([-5 15 -5 20])
% grid